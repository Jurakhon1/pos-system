# Отладка системы логина

## Проблемы, которые были исправлены:

### 1. Layout проблема
- **Проблема**: Сайдбар и тулбар отображались на всех страницах, включая страницу логина
- **Решение**: Создан условный рендеринг в `LayoutContent.tsx`, который скрывает сайдбар на страницах аутентификации

### 2. API конфигурация
- **Проблема**: API был настроен на внешний сервер, который недоступен
- **Решение**: Создан локальный API endpoint `/api/auth/login` для тестирования

### 3. Типизация
- **Проблема**: Несоответствие типов между API ответом и кодом
- **Решение**: Обновлены типы в `auth.ts` и добавлена правильная типизация ошибок

### 4. Middleware
- **Проблема**: Middleware мог блокировать API запросы
- **Решение**: Добавлены исключения для API роутов и статических файлов

## Как тестировать:

### 1. Запуск сервера разработки
```bash
npm run dev
```

### 2. Тестовые учетные данные
- **Admin**: `admin` / `admin123`
- **Cashier**: `cashier` / `cashier123`

### 3. Тестирование API
Перейдите на `/test-api` для прямого тестирования API без интерфейса

### 4. Тестирование логина
Перейдите на `/login` и используйте тестовые учетные данные

## Структура файлов:

```
src/
├── app/
│   ├── api/
│   │   └── auth/
│   │       ├── login/
│   │       │   └── route.ts          # API endpoint для логина
│   │       └── register/
│   │           └── route.ts          # API endpoint для регистрации
│   ├── login/
│   │   └── page.tsx                  # Страница логина
│   ├── test-api/
│   │   └── page.tsx                  # Тестовая страница API
│   ├── LayoutContent.tsx             # Условный рендеринг layout
│   └── layout.tsx                    # Основной layout
├── entities/
│   └── auth/
│       ├── api/
│       │   └── authApi.ts            # API клиент
│       └── hooks/
│           └── useAuth.ts            # Хук аутентификации
└── shared/
    ├── api/
    │   └── axios.ts                  # Конфигурация axios
    ├── providers/
    │   └── middleware.ts             # Middleware для роутинга
    └── types/
        └── auth.ts                   # Типы аутентификации
```

## Возможные проблемы:

### 1. CORS ошибки
- Убедитесь, что API endpoint доступен
- Проверьте консоль браузера на ошибки

### 2. Ошибки типизации
- Проверьте соответствие типов между API и фронтендом
- Убедитесь, что все импорты корректны

### 3. Проблемы с localStorage
- Проверьте, что код выполняется на клиенте
- Убедитесь, что браузер поддерживает localStorage

### 4. Проблемы с роутингом
- Проверьте middleware конфигурацию
- Убедитесь, что роуты правильно настроены

## Логирование:

Включено подробное логирование для отладки:
- Попытки входа
- Успешные ответы API
- Ошибки API
- JWT декодирование
- Перенаправления

Проверьте консоль браузера для получения подробной информации о процессе аутентификации.
