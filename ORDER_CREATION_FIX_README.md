# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ 400 (Bad Request) –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ –±—ç–∫–µ–Ω–¥–æ–º.

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- **`tableId`**: —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞–≤–∞–ª —á–∏—Å–ª–æ, –±—ç–∫–µ–Ω–¥ –æ–∂–∏–¥–∞–ª UUID —Å—Ç—Ä–æ–∫—É
- **`menuItemId`**: –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —É –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
- **API endpoints**: —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `/products` –≤–º–µ—Å—Ç–æ `/menu/items`

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
- –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω)
- –ù–µ –±—ã–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–∫–∞—Ü–∏–µ–π
- **`locationId`**: –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª —Ä–µ–∞–ª—å–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: —Å—Ç–æ–ª—ã –∏ –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ –ª–æ–∫–∞—Ü–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —Å—Ç–æ–ª–∞ –∫ –ª–æ–∫–∞—Ü–∏–∏

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (`src/entities/product/api/productsApi.ts`)
```typescript
// –ë—ã–ª–æ: /products
// –°—Ç–∞–ª–æ: /menu/items
getProducts: async (locationId?: string): Promise<Products[]> => {
  const params = new URLSearchParams();
  if (locationId) {
    params.append('location_id', locationId);
  }
  
  const response = await api.get(`/menu/items?${params.toString()}`);
  return response.data.map((item: any) => ({
    // ... –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
    menuItemId: item.id // –î–æ–±–∞–≤–ª–µ–Ω menuItemId
  }));
}
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`src/entities/categories/api/categoriesApi.ts`)
```typescript
// –ë—ã–ª–æ: /categories
// –°—Ç–∞–ª–æ: /menu/categories
getCategories: async (locationId?: string) => {
  const params = new URLSearchParams();
  if (locationId) {
    params.append('location_id', locationId);
  }
  
  const response = await api.get(`/menu/categories?${params.toString()}`);
  return response.data;
}
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API —Å—Ç–æ–ª–æ–≤ (`src/entities/tables/api/tableApi.ts`)
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ª–æ–∫–∞—Ü–∏–∏
async getTables(locationId?: string) {
  const params = new URLSearchParams();
  if (locationId) {
    params.append('locationId', locationId);
  }
  
  const { data } = await api.get<Table[]>(`/tables?${params.toString()}`);
  return data;
}
```

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`src/entities/auth/hooks/useAuth.ts`)
```typescript
// –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è locationId –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
const payload = JSON.parse(atob(data.accessToken.split('.')[1]));
if (payload.location_id) {
  localStorage.setItem("locationId", payload.location_id.toString());
}
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö—É–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **`useProducts`**: —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –ª–æ–∫–∞—Ü–∏–∏
- **`useCategories`**: —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –ª–æ–∫–∞—Ü–∏–∏
- **`useOrderCreation`**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç locationId –∏–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–∞
- –¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–æ–ª—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç UUID –≤–º–µ—Å—Ç–æ –Ω–æ–º–µ—Ä–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 7. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- `tableId` —Ç–µ–ø–µ—Ä—å `string | null` –≤–º–µ—Å—Ç–æ `number | null`
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏

### 8. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–∞ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ

### 9. –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `menuItemId` —É –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ `locationId` –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
2. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ª–æ–∫–∞—Ü–∏–∏ (—Å—Ç–æ–ª—ã, –º–µ–Ω—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
3. **–í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤** ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —Å `menuItemId`
4. **–í—ã–±–æ—Ä —Å—Ç–æ–ª–∞** ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ UUID —Å—Ç–æ–ª–∞ –∏–∑ API (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏)
5. **–ù–∞–∂–∞—Ç–∏–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"** ‚Üí –ø–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã
6. **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã** ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
7. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞** ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `locationId` –∏ `waiterId`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
```bash
cd pos-system
node debug-order-creation.js
```

### 2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
```bash
cd pos-system
node test-order-creation.js
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ POS —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ–ª
4. –ù–∞–∂–º–∏—Ç–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
6. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞

### 2. –ù–µ–≤–µ—Ä–Ω—ã–π `locationId` –≤ JWT
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ JWT —Ç–æ–∫–µ–Ω–µ –µ—Å—Ç—å `location_id`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ª–æ–∫–∞—Ü–∏–∏

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç–æ–ª–æ–≤ –≤ –±–∞–∑–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `tables` –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `location_id` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–Ω—é
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `menu_items`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `location_id` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 5. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–æ–ª—è–º–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Ä–æ–ª—å `waiter`, `cashier`, `admin` –∏–ª–∏ `superadmin`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª—ã –∏ –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
4. **–¢–µ—Å—Ç—ã**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ unit –∏ integration —Ç–µ—Å—Ç–æ–≤
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∑–∞–∫–∞–∑–∞–º–∏

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

- `src/entities/product/api/productsApi.ts`
- `src/entities/categories/api/categoriesApi.ts`
- `src/entities/tables/api/tableApi.ts`
- `src/entities/auth/hooks/useAuth.ts`
- `src/entities/product/hooks/useProducts.ts`
- `src/entities/categories/hooks/useCategories.ts`
- `src/features/table-selection/ui/TableSelection.tsx`
- `src/features/order-creation/hooks/useOrderCreation.ts`
- `src/features/order-creation/ui/OrderForm.tsx`
- `src/features/shopping-cart/ui/ShoppingCart.tsx`
- `src/widgets/pos-page/ui/POSPage.tsx`
- `test-order-creation.js` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
- `debug-order-creation.js` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
- `ORDER_CREATION_FIX_README.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** –∏ –±—ç–∫–µ–Ω–¥
2. **–û—á–∏—Å—Ç–∏—Ç–µ localStorage** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. **–ü–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ JWT —Ç–æ–∫–µ–Ω–∞
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
5. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑** —Å–Ω–æ–≤–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

## –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ `"Invalid table or table does not belong to location"`, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Å—Ç–æ–ª —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º `tableId` –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏.

### üîç **–ü–æ—à–∞–≥–æ–≤–∞—è –æ—Ç–ª–∞–¥–∫–∞:**

#### 1. –ó–∞–ø—É—Å–∫ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü
```bash
cd pos-system
node debug-table-location.js
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é
```bash
cd pos-system
node check-database.js
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ POS —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ª–æ–≥–∏ —Å —ç–º–æ–¥–∑–∏ üîç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏

### üö® **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏:**

#### A. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `locationId`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í JWT —Ç–æ–∫–µ–Ω–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `location_id`
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ JWT —Ç–æ–∫–µ–Ω

#### B. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç–æ–ª–æ–≤ –≤ –ª–æ–∫–∞—Ü–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í —Ç–∞–±–ª–∏—Ü–µ `tables` –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å `location_id = X`
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–∫–∞—Ü–∏–∏

#### C. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `tableId`
- **–ü—Ä–æ–±–ª–µ–º–∞**: `tableId` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è UUID
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç–æ–ª—ã –∏–º–µ—é—Ç UUID —Ñ–æ—Ä–º–∞—Ç

#### D. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π API
- **–ü—Ä–æ–±–ª–µ–º–∞**: API `/tables?locationId=X` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±—ç–∫–µ–Ω–¥ API —Å—Ç–æ–ª–æ–≤

### üõ†Ô∏è **–ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
const token = localStorage.getItem('token');
const payload = JSON.parse(atob(token.split('.')[1]));
console.log('JWT payload:', payload);
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
console.log('locationId:', localStorage.getItem('locationId'));
console.log('userId:', localStorage.getItem('userId'));
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å—Ç–æ–ª–æ–≤
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
fetch('/api/tables?locationId=YOUR_LOCATION_ID', {
  headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
}).then(r => r.json()).then(console.log);
```

### üìä **–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

#### –¢–∞–±–ª–∏—Ü–∞ `locations`:
```sql
SELECT * FROM locations;
-- –î–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∑–∞–ø–∏—Å—å
```

#### –¢–∞–±–ª–∏—Ü–∞ `tables`:
```sql
SELECT * FROM tables WHERE location_id = 'YOUR_LOCATION_ID';
-- –î–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–æ–ª—ã –¥–ª—è –≤–∞—à–µ–π –ª–æ–∫–∞—Ü–∏–∏
```

#### –¢–∞–±–ª–∏—Ü–∞ `users`:
```sql
SELECT * FROM users WHERE location_id = 'YOUR_LOCATION_ID' AND role = 'waiter';
-- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –≤ –ª–æ–∫–∞—Ü–∏–∏
```

### üîß **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

#### 1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é:
```sql
INSERT INTO locations (id, name, address) VALUES ('2', '–†–µ—Å—Ç–æ—Ä–∞–Ω', '—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 1');
```

#### 2. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª—ã:
```sql
INSERT INTO tables (id, location_id, number, capacity, is_active) 
VALUES 
  (UUID(), '2', '1', 4, 1),
  (UUID(), '2', '2', 4, 1),
  (UUID(), '2', '3', 6, 1);
```

#### 3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞:
```sql
INSERT INTO users (id, username, password, role, location_id, is_active) 
VALUES (UUID(), 'waiter1', 'hashed_password', 'waiter', '2', 1);
```

### üìù **–õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:

```
üîç getCurrentLocationId called, result: 2
üîç Fetching tables for location: 2
üîç API Tables URL: /tables?locationId=2
üîç LocationId parameter: 2
‚úÖ Tables API response: [...]
‚úÖ Loaded tables: [...]
üìä Tables count: 3
```

–ï—Å–ª–∏ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

## üö® **–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞**

### **–ü—Ä–æ–±–ª–µ–º–∞:**
```
Duplicate entry '20250819-0001' for key 'orders.IDX_75eba1c6b1a66b09f2a97e6927'
```

### **–ü—Ä–∏—á–∏–Ω–∞:**
Race condition –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞ - –¥–≤–∞ –∑–∞–∫–∞–∑–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä.

### **–†–µ—à–µ–Ω–∏–µ:**

#### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±—ç–∫–µ–Ω–¥** (`orders.service.ts`):
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 2. **–î–æ–±–∞–≤–ª–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ MySQL:
ALTER TABLE orders ADD UNIQUE INDEX idx_order_number_unique (order_number);
```

#### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:**
```bash
cd pos-system
# –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç:
mysql -u root -p smartchef < fix-order-number-index.sql
```

### **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ race condition
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥**
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑** —Å–Ω–æ–≤–∞

–¢–µ–ø–µ—Ä—å –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–æ–≤ –±—É–¥—É—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç!

## üö® **–û—à–∏–±–∫–∞ NaN –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö –∑–∞–∫–∞–∑–æ–≤**

### **–ü—Ä–æ–±–ª–µ–º–∞:**
```
Unknown column 'NaN' in 'field list'
```

### **–ü—Ä–∏—á–∏–Ω–∞:**
–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ü–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ `NaN` (Not a Number).

### **–†–µ—à–µ–Ω–∏–µ:**

#### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±—ç–∫–µ–Ω–¥** (`orders.service.ts`):
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ OrderItem
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–∞–º–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å NaN
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

#### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```bash
cd pos-system
# –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç:
mysql -u root -p smartchef < check-prices.sql
```

#### 3. **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è `menuItem.price` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `total_price` –Ω–∞ NaN
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥**
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç** –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑** —Å–Ω–æ–≤–∞

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
–í –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```
Order totals calculated: { subtotal: 380.00, taxAmount: 38.00, totalAmount: 418.00 }
```

–ï—Å–ª–∏ —Ü–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞:
```
Invalid price for menu item: [–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è_—Ü–µ–Ω–∞]
```

–¢–µ–ø–µ—Ä—å –≤—Å–µ —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚úÖ **"Invalid table or table does not belong to location"** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ **"Duplicate entry" –¥–ª—è –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
- ‚úÖ **"Unknown column 'NaN'" –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üöÄ
